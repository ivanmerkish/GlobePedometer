<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Global Steps Challenge</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/globe.gl"></script>
</head>
<body>

  <div id="login-screen">
    <h1 style="color: white; font-size: 2.5rem; margin-bottom: 30px;">üåç EARTH RUN</h1>
    <button class="login-btn" onclick="signIn()">
      <img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" width="24">
      –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
    </button>
    
    <div style="margin-top: 20px;">
      <script async src="https://telegram.org/js/telegram-widget.js?22" 
              data-telegram-login="GlobePedometer_bot" 
              data-size="large" 
              data-radius="5"
              data-onauth="onTelegramAuth(user)" 
              data-request-access="write"></script>
    </div>
  </div>

  <div id="ui-layer">
    <div class="user-card">
      <div id="my-avatar-preview" class="user-avatar" onclick="openProfileSettings()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è"></div>
      <div>
        <div id="my-name" style="font-weight: bold;">–ì–æ—Å—Ç—å</div>
        <div style="font-size: 0.8rem; color: #94a3b8; cursor: pointer;" onclick="signOut()">–í—ã–π—Ç–∏</div>
      </div>
    </div>

    <div id="avatar-selection"></div>

    <div class="stats-box">
      <div style="font-size: 0.8rem; color: #94a3b8;">–í—Å–µ–≥–æ —à–∞–≥–æ–≤:</div>
      <div id="totalStepsDisplay" style="font-size: 1.5rem; font-weight: bold; color: white;">0</div>
    </div>

    <label>–î–æ–±–∞–≤–∏—Ç—å —à–∞–≥–∏ (+):</label>
    <div style="display: flex; gap: 8px;">
      <input type="number" id="addStepsInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5000">
      
      <label class="action-btn" style="width: 40px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0;" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç">
        üì∑
        <input type="file" id="screenshotInput" accept="image/*" style="display: none;" onchange="uploadScreenshot(event)">
      </label>

      <button class="action-btn" style="margin-bottom: 10px;" onclick="addSteps()">‚ûï</button>
    </div>
    
    <div class="stats-row">
      <div>–í–∞—à –ø—É—Ç—å: <span id="kmDisplay" style="color: #38bdf8; font-weight: bold;">0</span> –∫–º</div>
      <button class="icon-btn" onclick="recenterView()" title="–ù–∞–π—Ç–∏ –º–µ–Ω—è">üéØ</button>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profile-modal" class="modal-overlay">
    <div class="modal-content">
      <h2 id="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h2>
      
      <label>–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è:</label>
      <input type="text" id="modal-nickname" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º">
      
      <label>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä:</label>
      <div id="modal-avatar-selection" class="avatar-grid"></div>

      <div class="modal-actions">
        <button class="action-btn" onclick="saveProfileSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="secondary-btn" id="modal-close-btn" onclick="closeProfileModal()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <div id="globeViz"></div>

  <script type="module" src="main.js"></script>
</body>
</html>
